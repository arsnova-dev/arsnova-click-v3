@startuml activity-dozent-student
' ============================================================================
' arsnova.click V3 â€“ Activity-Diagramm: Dozent â†” Student Interaktion
' Zeigt den kompletten Ablauf von Quiz-Erstellung bis Session-Ende
' ============================================================================

!theme plain
skinparam shadowing false
skinparam ActivityBackgroundColor #ffffff
skinparam ActivityBorderColor #333333
skinparam PartitionBackgroundColor #f5f5f5

title arsnova.click V3 â€“ Ablauf einer Quiz-Session\n(Dozent â†” Student)

|#e8f5e9| ğŸ“ Dozent |
|#e3f2fd| ğŸ“± Student |
|#fff3e0| âš™ï¸ Server |

' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
' Phase 1: Quiz-Erstellung (Local-First)
' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

|ğŸ“ Dozent|
start
:Quiz erstellen\n(Name, Beschreibung);
note right
  Lokal in IndexedDB (Yjs CRDT)
  Kein Server-Roundtrip!
end note

:Preset wÃ¤hlen\nğŸ® Spielerisch / ğŸ“ SeriÃ¶s;

:Fragen hinzufÃ¼gen\n(MC / SC / Freitext / Umfrage / Rating);

:Antwortoptionen definieren\n& korrekte markieren âœ“;

:Konfiguration anpassen\n(Timer, Nickname-Theme,\nLeaderboard, Sounds, â€¦);

:Quiz lokal gespeichert âœ…;

' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
' Phase 2: Session starten
' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

:Quiz live schalten ğŸš€;

|âš™ï¸ Server|
:session.create()\nâ†’ 6-stelliger Code generiert;
:Quiz-Daten + isCorrect\nin PostgreSQL speichern;
:Session-Status = **LOBBY**;

|ğŸ“ Dozent|
:Session-Code + QR-Code\nanzeigen (Beamer);

' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
' Phase 3: Studenten treten bei
' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

|ğŸ“± Student|
:Session-Code eingeben\n(oder QR-Code scannen);

|âš™ï¸ Server|
:session.join()\nâ†’ Code validieren;

if (Code gÃ¼ltig?) then (ja)
  |ğŸ“± Student|

  if (Anonymer Modus?) then (ja)
    :Automatische ID zuweisen\n"Teilnehmer #7";
  else (nein)
    :Nickname aus Themenliste\nwÃ¤hlen oder frei eingeben;
  endif

  |âš™ï¸ Server|
  :Participant in DB speichern\n(Unique: Session + Nickname);
  :WS-Event: onParticipantJoined\nan Dozent pushen;

  |ğŸ“ Dozent|
  :Teilnehmer in Lobby\nlive anzeigen ğŸ‘¥;

else (nein)
  |ğŸ“± Student|
  :Fehlermeldung\n"Code ungÃ¼ltig" âŒ;
  stop
endif

' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
' Phase 4: Quiz-DurchfÃ¼hrung (Schleife pro Frage)
' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

|ğŸ“ Dozent|
:Auf "NÃ¤chste Frage"\nklicken â–¶ï¸;

|âš™ï¸ Server|
:Session-Status = **ACTIVE**\ncurrentQuestion++;
:QuestionStudentDTO erstellen\nâš ï¸ isCorrect ENTFERNT!;
:WS-Event: onQuestionRevealed\nan alle Studenten;

repeat

  |ğŸ“± Student|
  :Frage + Antwortoptionen\nempfangen & anzeigen;
  note right
    â–³ A  â—‹ B  â–¡ C  â—‡ D
    Vollbreite Buttons
    Thumb Zone (unten)
  end note

  if (Timer gesetzt?) then (ja)
    |ğŸ“± Student|
    :â±ï¸ Countdown anzeigen\n(synchron via Server-Timestamp);
  else (nein)
    :Offene Antwortphase\n(Dozent beendet manuell);
  endif

  |ğŸ“± Student|

  switch (Fragentyp?)
    case ( MC )
      :Mehrere Optionen\ntogglen + Absenden;
    case ( SC )
      :Eine Option antippen\nâ†’ sofort abgesendet;
    case ( Freitext )
      :Text eingeben\n+ Absenden;
    case ( Rating )
      :Skalenwert wÃ¤hlen\n(1â€“5 oder 1â€“10);
    case ( Umfrage )
      :Option wÃ¤hlen\n(kein richtig/falsch);
  endswitch

  :Optimistisches UI-Update\n"Antwort gesendet âœ“";

  |âš™ï¸ Server|
  :vote.submit()\nâ†’ Antwort validieren & speichern;
  :Score berechnen\nscore = difficulty Ã— timeBonus;
  :Streak aktualisieren\nfinalScore = score Ã— streakMultiplier;

  |ğŸ“ Dozent|
  :Live-Abstimmungsbalken\nauf Beamer aktualisieren ğŸ“Š;

  :Auf "Ergebnis zeigen"\nklicken ğŸ“ˆ;

  |âš™ï¸ Server|
  :Session-Status = **RESULTS**;
  :QuestionRevealedDTO erstellen\nâœ… isCorrect JETZT enthalten;
  :PersonalScorecardDTO\npro Participant berechnen;
  :WS-Events pushen:\nâ€¢ onResultsRevealed (alle)\nâ€¢ onPersonalResult (individuell);

  |ğŸ“± Student|
  :Eigene Antwort markiert\nâœ“ grÃ¼n / âœ— rot;
  :PersÃ¶nliche Scorecard\nals Bottom-Sheet:\nâ€¢ Punkte + Streak ğŸ”¥\nâ€¢ Rang + VerÃ¤nderung â†‘â†“\nâ€¢ Motivationsmeldung ğŸ’ª;

  if (Emoji-Reaktionen aktiv?) then (ja)
    :Emoji-Leiste anzeigen\nğŸ‘ ğŸ‰ ğŸ˜® ğŸ˜‚ ğŸ˜¢;
    :Emoji antippen â†’ Server;
    |âš™ï¸ Server|
    :session.react()\nâ†’ Emoji via Redis pushen;
    |ğŸ“ Dozent|
    :Emoji-Blasen auf\nBeamer animieren ğŸ‰;
  else (nein)
  endif

  |ğŸ“ Dozent|
  :Ergebnis-Visualisierung\nauf Beamer anzeigen;

  if (Leaderboard aktiv?) then (ja)
    :Leaderboard-Zwischenstand\nTop 5 anzeigen ğŸ†;
  else (nein)
  endif

  if (Weitere Fragen?) then (ja)
    |âš™ï¸ Server|
    :Session-Status = **PAUSED**;
    |ğŸ“ Dozent|
    :Auf "NÃ¤chste Frage"\nklicken â–¶ï¸;
    |âš™ï¸ Server|
    :Session-Status = **ACTIVE**\ncurrentQuestion++;
    :QuestionStudentDTO pushen\nâš ï¸ isCorrect ENTFERNT;
  else (nein)
  endif

repeat while (Weitere Fragen?) is (ja) not (nein)

' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
' Phase 5: Session beenden
' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

|ğŸ“ Dozent|
:Auf "Quiz beenden"\nklicken ğŸ;

|âš™ï¸ Server|
:session.end()\nSession-Status = **FINISHED**;
:Finales Leaderboard berechnen\n(Sortierung: Score â†’ Antwortzeit);
:Redis-Keys lÃ¶schen\n(flÃ¼chtige Daten entfernt);

|ğŸ“ Dozent|
:Finales Leaderboard\nauf Beamer anzeigen ğŸ†;

if (Belohnungseffekte aktiv?) then (ja)
  :ğŸ¥‡ Platz 1: Konfetti + Gold-Pokal\nğŸ¥ˆ Platz 2: Silber-Medaille\nğŸ¥‰ Platz 3: Bronze-Medaille;
else (nein)
endif

|ğŸ“± Student|
:Finales Ranking\nauf Smartphone sehen;
:Session-Teilnahme beendet ğŸ‘‹;

|âš™ï¸ Server|
:Auto-Cleanup nach 24h\nfÃ¼r nicht beendete Sessions â™»ï¸;

|ğŸ“ Dozent|
:Quiz bleibt lokal\nin IndexedDB erhalten ğŸ’¾;
stop

' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
' Legende
' â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

legend bottom
  | Symbol | Bedeutung |
  | âš ï¸ | Sicherheitsrelevante Aktion (Data-Stripping) |
  | ğŸ”¥ | Streak-Indikator (â‰¥ 3 richtige in Folge) |
  | ğŸ“Š | Echtzeit-Aktualisierung via WebSocket |
  | ğŸ’¾ | Local-First (IndexedDB / Yjs) |
  | â™»ï¸ | Automatisches Cleanup |
endlegend

@enduml
